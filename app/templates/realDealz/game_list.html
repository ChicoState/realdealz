{% extends "search.html" %}
{% block content %}

<style>
  .blue {
    color: blue;
  }

  li {
    font-size: 18px;
  }

  table {
    table-layout: fixed;  
  }

  th.id, td.id {
    width: 50px;
  }  

  th.name, td.name {
    width: 400px;
  }

  th.price, td.price {
    width: 100px;
  }

  th.developer, td.developer {
    width: 800px;
  }

  th, td {
    word-wrap: break-word;
  }

</style>



<h1>Deals List</h1>
<div class="buttonoverlay">
  <form method="post">
    {% csrf_token %}
    <label for="filtered_price" style="width: 110px;">Maximum Cost:</label>
    <input type="text" name="filtered_price" id="filtered_price" style="width: 50px; color: black;">
    <input class="blue" type="submit" value="Filter">
  </form>
  <form method="post">
    {% csrf_token %}
    <label for="filtered_id" style="width: 110px;">ID:</label>
    <input type="text" name="filtered_id" id="filtered_id" style="width: 50px; color: black;">
    <input class="blue" type="submit" value="Filter">
  </form>  
  <form method="post">
    {% csrf_token %}
    <label for="filtered_developer" style="width: 110px;">Developer:</label>
    <br>
    <input type="text" name="filtered_developer" id="filtered_developer" style="width: 160px; color: black;">
    <input class="blue" type="submit" value="Filter">
  </form>       
  <br>
  <button class="blue" style="width: 110px;" id="highest">Sort by Highest Price</button>
  <br>
  <br>
  <button class="blue" style="width: 110px;" id="lowest">Sort by Lowest Price</button>
  <br>
  <br>
  <form method="post">
    {% csrf_token %}    
    <button class="blue" type="submit" name="clear" value="clear" style="width: 110px;">Clear Filters</button>
  </form>   
  <br>
</div>

<table class="tableorganizer" id="tablegames">
  <thead>
    <tr>
      <th>ID</th>
      <th>Game Title</th>
      <th>Price</th>
      <th>Developer</th>
    </tr>
  </thead>
  <tbody>
    {% if filtered_table %}
      {% for Game in filtered_table %}
      <tr>
        <td class="id">{{ Game.appid }}</td>        
        <td class="name"><a href="{{ Game.get_absolute_url }}">{{ Game.name }}</a></td>
        <td class="price">$ {{ Game.price }}</td>
        <td class="developer">{{ Game.developer }}</td>      
      </tr>
      {% endfor %}      
    {% endif %}      
  </tbody>
</table>


<br>
<br>
<br> 
<br>
<br>
<br>

{% comment %}
<div class="centertext">
  <div class="pagination">
    {% for num in games_page.paginator.page_range %}
        {% if games_page.number == num %}
            <span>{{ num }}</span>
        {% elif num > games_page.number|add:'-3' and num < games_page.number|add:'3' %}
            <a href="?page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}
  </div>
</div>
{% endcomment %}





<script>
  //Activates when the page is loaded
  document.addEventListener("DOMContentLoaded", function() {

    //This code looks for the id "lowest" in the html page and triggers the function when a user clicks the id
    document.getElementById("lowest").addEventListener("click", function() {

      // Load table data into a variable, the table needs to have an id
      var table = document.getElementById("tablegames");

      // Create an array to store table rows
      var rows = [];

      // Iterate through table rows and store them in the array
      for (var i = 0, row; row = table.rows[i]; i++) {
          rows.push(row);
      }

      // Sort the array based on the value of the second cell (price)
      rows.sort(function(a, b) {
          var priceA = parseFloat(a.cells[2].innerHTML.replace(/[^0-9.]/g, ''));
          var priceB = parseFloat(b.cells[2].innerHTML.replace(/[^0-9.]/g, ''));
          return priceA - priceB;
      });

      // Clear the table body
      var tbody = table.getElementsByTagName("tbody")[0];
      tbody.innerHTML = "";

      // Rebuild the table with the sorted rows
      for (var i = 0; i < rows.length; i++) {
          tbody.appendChild(rows[i]);
      }
    });


    document.getElementById("highest").addEventListener("click", function() {

      // Load table data into a variable
      var table = document.getElementById("tablegames");

      // Create an array to store table rows
      var rows = [];

      // Iterate through table rows and store them in the array
      for (var i = 0, row; row = table.rows[i]; i++) {
          rows.push(row);
      }

      // Sort the array based on the value of the second cell (price)
      rows.sort(function(a, b) {
          var priceA = parseFloat(a.cells[2].innerHTML.replace(/[^0-9.]/g, ''));
          var priceB = parseFloat(b.cells[2].innerHTML.replace(/[^0-9.]/g, ''));
          return priceB - priceA;
      });

      // Clear the table body
      var tbody = table.getElementsByTagName("tbody")[0];
      tbody.innerHTML = "";

      // Rebuild the table with the sorted rows
      for (var i = 0; i < rows.length; i++) {
          tbody.appendChild(rows[i]);
      }
    });


  });
</script>
{% endblock %}
